<div class="embedded-content" ng-controller="DisPlay.Umbraco.EmbeddedContent.EmbdeddedContentController as ctrl" ng-show="ctrl.contentReady">

  <div class="embedded-content__title-bar">
    <div class="embedded-content__title-bar-title">{{ctrl.label}}</div>
    <!-- Maybe add model.description? -->

    <div class="embedded-content__has-config" ng-if="ctrl.hasConfig">
      <localize key="grid_settingsApplied" />
    </div>

    <div class="embedded-content__tools">
       <div class="embedded-content__tools-tool" ng-if="ctrl.hasSettings">
         <i class="icon icon-settings" title="@embeddedContent_settings" localize="title" ng-click="ctrl.editSettings()"></i>
       </div>
    </div>
  </div>

  <div ui-sortable="ctrl.sortableOptions" ng-model="ctrl.items">
    <div class="embedded-content__item"
         ng-class="{
          'embedded-content__item--active': item.active,
          'embedded-content__item--disabled': !item.published
         }"
         ng-repeat="item in ctrl.items"
         ng-click="ctrl.activate(item)"
         on-outside-click="ctrl.deactivate(item)"
         ng-form>

      <div class="embedded-content__control-bar">
        <div class="embedded-content__item-title">
          <i class="icon {{item.icon}}"></i>
          <span>{{item.name}}</span>
          <small class="embedded-content__content-type-name">{{item.contentTypeName}}</small>
        </div>
        <div class="embedded-content__has-config" ng-if="item.hasConfig">
          <localize key="grid_settingsApplied" />
        </div>
        <div class="embedded-content__tools" ng-show="item.active">
          <div class="embedded-content__tools-tool">
            <i class="embedded-content__tools-icon icon-settings" title="@embeddedContent_settings" localize="title" ng-click="ctrl.editSettings(item, $event)"></i>
          </div>
          <div class="embedded-content__tools-tool">
            <i class="embedded-content__tools-icon icon-trash" ng-click="ctrl.togglePrompt(item)"></i>
            <umb-confirm-action
              ng-if="item.deletePrompt"
              direction="left"
              on-confirm="ctrl.remove($index)"
              on-cancel="ctrl.hidePrompt(item)">
            </umb-confirm-action>
          </div>
        </div>
      </div>
      <div class="embedded-content__item-content" ng-show="item.active">
        <umb-property ng-repeat="property in item.properties" property="property">
          <umb-editor model="property"></umb-editor>
        </umb-property>
      </div>
    </div>
  </div>

  <div class="embedded-content__placeholder"
       ng-class="{'embedded-content__placeholder--small': ctrl.items.length > 0}"
       ng-click="ctrl.openContentTypeOverlay($event)">
    <div class="embedded-content__add"><localize key="embeddedContent_addContent" /></div>
  </div>

  <umb-overlay
    ng-if="ctrl.contentTypeOverlay.show"
    model="ctrl.contentTypeOverlay"
    view="ctrl.contentTypeOverlay.view"
    position="target">
  </umb-overlay>

  <umb-overlay
    ng-if="ctrl.editSettingsOverlay.show"
    model="ctrl.editSettingsOverlay"
    view="ctrl.editSettingsOverlay.view"
    position="right">
  </umb-overlay>
</div>
