<div class="embedded-content" ng-controller="DisPlay.Umbraco.EmbeddedContent.EmbdeddedContentController as ctrl" ng-show="ctrl.contentReady">

  <div class="embedded-content__title-bar">
    <div class="embedded-content__title-bar-title">{{ctrl.label}}</div>
    <!-- Maybe add model.description? -->

    <div class="embedded-content__has-config" ng-if="ctrl.hasConfig">
      <localize key="grid_settingsApplied" />
    </div>

    <div class="embedded-content__tools">
       <div class="embedded-content__tools-tool" ng-if="ctrl.hasSettings">
         <i class="icon icon-settings" title="@embeddedContent_settings" localize="title" ng-click="ctrl.editSettings()"></i>
       </div>
    </div>
  </div>

  <div ui-sortable="ctrl.sortableOptions" ng-model="model.value">
    <div class="embedded-content__item"
         ng-class="{
          'embedded-content__item--active': item.active || ctrl.config.enableCollapsing === '0',
          'embedded-content__item--disabled': !item.published
         }"
         ng-repeat="item in model.value"
         ng-click="ctrl.activate(item)"
         on-outside-click="ctrl.deactivate(item)"
         ng-form>

      <div class="embedded-content__control-bar">
        <div class="embedded-content__item-title">
          <i class="icon {{item.icon}}"></i>
          <span>{{item.name}}</span>
          <small class="embedded-content__content-type-name">{{item.contentTypeName}}</small>
        </div>
        <div class="embedded-content__has-config" ng-if="item.hasConfig">
          <localize key="grid_settingsApplied" />
        </div>
        <div class="embedded-content__tools" ng-show="item.active || ctrl.config.enableCollapsing === '0'">
          <div class="embedded-content__tools-tool">
            <i class="embedded-content__tools-icon icon-settings" title="@embeddedContent_settings" localize="title" ng-click="ctrl.editSettings(item, $event)"></i>
          </div>
          <div class="embedded-content__tools-tool">
            <i class="embedded-content__tools-icon icon-trash" ng-click="ctrl.togglePrompt(item)"></i>
            <umb-confirm-action
              ng-if="item.deletePrompt"
              direction="left"
              on-confirm="ctrl.remove($index)"
              on-cancel="ctrl.hidePrompt(item)">
            </umb-confirm-action>
          </div>
        </div>
      </div>
      <div class="embedded-content__item-content" ng-show="item.active || ctrl.config.enableCollapsing === '0'">
        <umb-property ng-repeat="property in item.properties" property="property">
          <umb-editor model="property" set-files="ctrl.setFiles(files)" embedded-content-files-watcher></umb-editor>
        </umb-property>
      </div>
    </div>
  </div>

  <div class="embedded-content__placeholder"
       ng-class="{'embedded-content__placeholder--small': model.value.length > 0}"
       ng-click="ctrl.openContentTypeOverlay($event)"
       ng-show="!ctrl.config.maxItems || model.value.length < ctrl.config.maxItems">
    <div class="embedded-content__add"><localize key="embeddedContent_addContent" /></div>
  </div>

  <input type="hidden" name="minItems" ng-model="model">
  <input type="hidden" name="maxItems" ng-model="model">

  <div class="help-inline" val-msg-for="minItems" val-toggle-msg="minItems">
      You need to add at least {{ctrl.config.minItems - model.value.length}} more item(s)
  </div>

  <div class="help-inline" val-msg-for="maxItems" val-toggle-msg="maxItems">
      You can only have {{ctrl.config.maxItems}} item(s) selected
  </div>

  <umb-overlay
    ng-if="ctrl.contentTypeOverlay.show"
    model="ctrl.contentTypeOverlay"
    view="ctrl.contentTypeOverlay.view"
    position="target">
  </umb-overlay>

  <umb-overlay
    ng-if="ctrl.editSettingsOverlay.show"
    model="ctrl.editSettingsOverlay"
    view="ctrl.editSettingsOverlay.view"
    position="right">
  </umb-overlay>
</div>
